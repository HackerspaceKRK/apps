api:
  insecure: true

providers:
  docker:
    exposedByDefault: false
    swarmMode: true

entryPoints:
  web:
    address: ":80"
    forwardedHeaders:
      trustedIPs:
        - "10.0.0.0/16"
    http:
      redirections:
        entryPoint:
          to: "websecure"
          scheme: "https"

  websecure:
    address: ":443"

certificatesResolvers:
  myresolver:
    acme:
      storage: "/traefik/acme/acme.json"
      httpChallenge:
        entryPoint: "web"

http:
  services:
    oscilloscope-service:
      loadBalancer:
        servers:
          - url: "http://10.12.10.145"
    spectrum-analyzer-service:
      loadBalancer:
        servers:
          - url: "http://10.12.10.144"

  routers:
    oscilloscope-router:
      entryPoints:
        - "web"
        - "websecure"
      service: oscilloscope-service
      rule: "Host(`oscyloskop.at.hskrk.pl`) || Host(`oscilloscope.at.hskrk.pl`)"
      tls:
        certResolver: myresolver
      middlewares:
        - authentik@docker
    spectrum-analyzer-router:
      entryPoints:
        - "web"
        - "websecure"
      service: spectrum-analyzer-service
      rule: "Host(`sa.at.hskrk.pl`)"
      tls:
        certResolver: myresolver
      middlewares:
        - authentik@docker
