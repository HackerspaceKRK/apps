version: "3.7"
services:
  nodered:
    image: nodered/node-red:latest
    restart: unless-stopped
    networks:
      - system_default
    deploy:
      replicas: 1
      restart_policy:
        condition: on-failure
        max_attempts: 5
      labels:
        - "traefik.enable=true"
        - "traefik.docker.network=system_default"
        - "traefik.port=80"
        - "traefik.http.services.nodered.loadbalancer.server.port=1880"
        - "traefik.http.routers.nodered.rule=Host(`nodered.apps.hskrk.pl`)"
        - "traefik.http.routers.nodered.middlewares=authentik@docker"
    volumes:
      - nodered_data:/data

volumes:
  nodered_data:

networks:
  system_default:
    external: true